# 财务分析指标文档

## 概述

本文档详细说明了财务分析系统中使用的所有财务指标，包括计算公式、数据要求、业务含义和验证规则。系统现已支持**5大分析维度17个核心财务指标**，全面覆盖企业财务分析的各个方面。

### 指标统计概览
- **盈利能力指标**: 4个（毛利率、净利率、ROE、ROA）
- **偿债能力指标**: 3个（资产负债率、流动比率、速动比率）
- **运营效率指标**: 3个（总资产周转率、存货周转率、应收账款周转率）
- **成长能力指标**: 2个（营业收入增长率、净利润增长率）
- **现金能力分析指标**: 5个（经营活动现金流、现金流量比率、自由现金流、现金再投资比率、现金投资保障比率）

**总计**: 17个核心财务指标
**数据源**: AKShare A股财务数据
**计算成功率**: 91%+
**更新日期**: 2025-10-25

## 指标分类

### 1. 盈利能力指标

#### 1.1 毛利率 (Gross Profit Margin)
- **计算公式**: `(营业收入 - 营业成本) / 营业收入 × 100%`
- **数据要求**:
  - `营业收入` (或 `TOTAL_OPERATE_INCOME`)
  - `营业成本` (或 `TOTAL_OPERATE_COST`)
- **业务含义**: 反映企业主营业务的盈利能力，毛利越高说明产品或服务的竞争力越强
- **合理范围**: 通常在 -100% 到 100% 之间
- **数据验证**:
  - 营业收入必须大于0
  - 自动修复异常值，默认使用行业平均值20%

#### 1.2 净利率 (Net Profit Margin)
- **计算公式**: `净利润 / 营业收入 × 100%`
- **数据要求**:
  - `净利润` (或 `NETPROFIT`)
  - `营业收入` (或 `TOTAL_OPERATE_INCOME`)
- **业务含义**: 反映企业最终的盈利能力，是经营效率的综合体现
- **合理范围**: 通常在 -50% 到 50% 之间
- **数据验证**:
  - 营业收入必须大于0
  - 异常值自动修正到合理范围

#### 1.3 净资产收益率 (ROE - Return on Equity)
- **计算公式**: `归属于母公司所有者的净利润 / 所有者权益合计 × 100%`
- **数据要求**:
  - `归属于母公司所有者的净利润` (或 `PARENT_NETPROFIT`)
  - `所有者权益合计` (或 `TOTAL_EQUITY`)
- **业务含义**: 反映股东权益的收益水平，是衡量企业为股东创造价值能力的重要指标
- **合理范围**: 通常在 -100% 到 100% 之间
- **数据验证**:
  - 所有者权益必须大于0
  - 异常值自动修正到合理范围

#### 1.4 总资产收益率 (ROA - Return on Assets)
- **计算公式**: `净利润 / 总资产 × 100%`
- **数据要求**:
  - `净利润` (或 `NETPROFIT`)
  - `总资产` (或 `TOTAL_ASSETS`)
- **业务含义**: 反映企业利用全部资产的盈利能力，衡量资产使用效率
- **合理范围**: 通常在 -50% 到 50% 之间
- **数据验证**:
  - 总资产必须大于0
  - 异常值自动修正到合理范围

### 2. 偿债能力指标

#### 2.1 资产负债率 (Debt to Asset Ratio)
- **计算公式**: `负债合计 / 资产总计 × 100%`
- **数据要求**:
  - `负债合计` (或 `TOTAL_LIABILITIES`)
  - `资产总计` (或 `TOTAL_ASSETS`)
- **业务含义**: 反映企业总资产中有多少是通过负债筹集的，衡量财务杠杆和风险水平
- **合理范围**: 通常在 0% 到 100% 之间
- **数据验证**:
  - 总资产必须大于0
  - 异常值自动修正到合理范围

#### 2.2 流动比率 (Current Ratio)
- **计算公式**: `流动资产合计 / 流动负债合计`
- **数据要求**:
  - `流动资产合计` (或 `TOTAL_CURRENT_ASSETS`)
  - `流动负债合计` (或 `TOTAL_CURRENT_LIABILITIES`)
- **业务含义**: 反映企业短期偿债能力，衡量流动资产对流动负债的保障程度
- **合理范围**: 通常在 0.1 到 10 之间，理想值约为2
- **数据验证**:
  - 流动负债必须大于0
  - 异常值自动修正，默认值为1.0

#### 2.3 速动比率 (Quick Ratio)
- **计算公式**: `(流动资产合计 - 存货) / 流动负债合计`
- **数据要求**:
  - `流动资产合计` (或 `TOTAL_CURRENT_ASSETS`)
  - `存货` (或 `INVENTORY`)
  - `流动负债合计` (或 `TOTAL_CURRENT_LIABILITIES`)
- **业务含义**: 反映企业立即偿债能力，剔除存货后衡量短期流动性
- **合理范围**: 通常在 0.1 到 5 之间，理想值约为1
- **数据验证**:
  - 流动负债必须大于0
  - 存货不超过流动资产，超过时自动修正
  - 异常值自动修正，默认值为0.8

### 3. 运营效率指标

#### 3.1 总资产周转率 (Asset Turnover)
- **计算公式**: `营业收入 / 平均总资产`
- **数据要求**:
  - `营业收入` (或 `TOTAL_OPERATE_INCOME`)
  - `总资产` (或 `TOTAL_ASSETS`) - 当期和上期
- **业务含义**: 反映企业资产利用效率，衡量资产产生收入的能力
- **合理范围**: 因行业而异，通常在0.1-5之间
- **数据验证**:
  - 平均资产必须大于0
  - 支持单期数据计算

#### 3.2 存货周转率 (Inventory Turnover)
- **计算公式**: `营业成本 / 平均存货`
- **数据要求**:
  - `营业成本` (或 `TOTAL_OPERATE_COST`)
  - `存货` (或 `INVENTORY`) - 当期和上期
- **业务含义**: 反映存货管理效率，衡量存货流动性
- **合理范围**: 因行业而异，通常在1-20之间
- **数据验证**:
  - 平均存货必须大于0
  - 支持单期数据计算

#### 3.3 应收账款周转率 (Receivables Turnover) - 新增
- **计算公式**: `营业收入 / 平均应收账款`
- **数据要求**:
  - `营业收入` (或 `TOTAL_OPERATE_INCOME`)
  - `应收账款` (或 `ACCOUNTS_RECE`, `ACCOUNTS_RECEIVABLE`) - 当期和上期
- **业务含义**: 反映应收账款回收速度，衡量信用政策效果和客户付款效率
- **合理范围**: 因行业而异，通常在0.1-50之间，理想值约为3-10
- **计算逻辑**:
  ```python
  # 支持单期和多期数据计算
  if len(balance_data) > 1:
      receivables_begin = 期初应收账款
      receivables_end = 期末应收账款
      avg_receivables = (receivables_begin + receivables_end) / 2
  else:
      avg_receivables = 期末应收账款  # 单期数据

  receivables_turnover = 营业收入 / avg_receivables
  ```
- **数据验证**:
  - 平均应收账款必须大于0
  - 异常值自动修正到合理范围（0.1-50）
  - 单期数据时使用当期应收账款计算
- **业务解读**:
  - **高值**: 收账速度快，信用政策严格，客户质量好
  - **低值**: 收账速度慢，可能存在坏账风险，信用政策宽松

### 4. 成长能力指标

#### 4.1 营业收入增长率 (Revenue Growth Rate)
- **计算公式**: `(本期营业收入 - 上期营业收入) / 上期营业收入 × 100%`
- **数据要求**:
  - `营业收入` (或 `TOTAL_OPERATE_INCOME`) - 连续两期数据
- **业务含义**: 反映企业业务扩张能力，衡量收入增长趋势
- **合理范围**: 通常在 -100% 到 1000% 之间
- **数据验证**:
  - 上期收入必须大于0
  - 单期数据时默认设为0%

#### 4.2 净利润增长率 (Profit Growth Rate)
- **计算公式**: `(本期净利润 - 上期净利润) / 上期净利润 × 100%`
- **数据要求**:
  - `净利润` (或 `NETPROFIT`) - 连续两期数据
- **业务含义**: 反映企业盈利增长能力，衡量利润增长趋势
- **合理范围**: 通常在 -100% 到 1000% 之间
- **数据验证**:
  - 上期利润必须大于0
  - 单期数据时默认设为0%

### 5. 现金能力分析指标 (Cash Flow Analysis) - 新增模块

现金能力分析是财务分析的重要组成部分，通过分析企业的现金流动情况，评估企业的财务健康度和持续经营能力。

#### 5.1 经营活动现金流 (Operating Cash Flow)
- **计算公式**: `经营活动产生的现金流量净额 / 1亿`（转换为亿元单位）
- **数据要求**:
  - `经营活动产生的现金流量净额` - 来自现金流量表
- **业务含义**: 反映企业核心业务产生现金的能力，是企业生存和发展的基础
- **单位**: 亿元
- **合理范围**: 因行业和规模而异，通常为正值较好
- **数据验证**:
  - 支持负值（表示经营现金流出）
  - 缺失数据时默认值为0
- **业务解读**:
  - **正值**: 主营业务现金创造能力强，经营质量高
  - **负值**: 主营业务现金消耗严重，需要关注经营状况
  - **高值**: 现金创造能力很强，财务状况健康
  - **低值**: 现金创造能力弱，需要改善经营效率

#### 5.2 现金流量比率 (Cash Flow Ratio)
- **计算公式**: `经营活动产生的现金流量净额 / 流动负债合计`
- **数据要求**:
  - `经营活动产生的现金流量净额` - 现金流量表
  - `流动负债合计` - 资产负债表
- **业务含义**: 反映企业用经营活动现金流偿还短期债务的能力
- **合理范围**: 通常在-5到5之间，理想值大于0.2
- **数据验证**:
  - 流动负债必须大于0
  - 支持负值，异常值自动修正到合理范围
  - 缺失数据时默认值为0.1
- **业务解读**:
  - **>1**: 经营现金流完全可以覆盖短期负债，偿债能力强
  - **0.2-1**: 经营现金流能部分覆盖短期负债，偿债能力尚可
  - **<0.2**: 经营现金流不足以覆盖短期负债，偿债压力大
  - **负值**: 经营现金流为负，短期偿债风险高

#### 5.3 自由现金流 (Free Cash Flow)
- **计算公式**: `(经营活动产生的现金流量净额 - 投资活动现金流出小计) / 1亿`
- **数据要求**:
  - `经营活动产生的现金流量净额` - 现金流量表
  - `投资活动现金流出小计` - 现金流量表
- **业务含义**: 反映企业在维持和扩大业务后可自由支配的现金
- **单位**: 亿元
- **合理范围**: 可正可负，正值表示现金充裕
- **数据验证**:
  - 支持负值（表示投资支出超过经营现金流入）
  - 缺失数据时默认值为0
- **业务解读**:
  - **正值**: 企业有充足现金用于分红、还债、回购股票等
  - **负值**: 企业需要外部融资来支持投资活动
  - **高值**: 现金充裕，财务灵活性高
  - **低值**: 现金紧张，财务压力较大

#### 5.4 现金再投资比率 (Cash Reinvestment Ratio)
- **计算公式**: `(经营活动产生的现金流量净额 - 分配股利、利润或偿付利息支付的现金) / (固定资产 + 长期投资 + 营运资本) × 100%`
- **数据要求**:
  - `经营活动产生的现金流量净额` - 现金流量表
  - `分配股利、利润或偿付利息支付的现金` - 现金流量表
  - `固定资产` - 资产负债表
  - `长期投资` - 资产负债表
  - `营运资本` = `流动资产合计 - 流动负债合计` - 资产负债表
- **业务含义**: 反映企业将经营活动现金流用于再投资的比例，衡量内部投资能力
- **合理范围**: 通常在0%-100%之间，理想值5%-15%
- **数据验证**:
  - 投资基数必须大于0
  - 异常值自动修正到合理范围（0%-100%）
  - 缺失数据时默认值为5%
- **业务解读**:
  - **高值 (>15%)**: 大部分现金流用于再投资，扩张意愿强烈
  - **适中 (5%-15%)**: 平衡的再投资策略，可持续发展
  - **低值 (<5%)**: 现金主要用于分红或其他用途，扩张意愿弱

#### 5.5 现金投资保障比率 (Cash to Investment Ratio)
- **计算公式**: `经营活动产生的现金流量净额 / (投资活动现金流出小计 + 分配股利、利润或偿付利息支付的现金)`
- **数据要求**:
  - `经营活动产生的现金流量净额` - 现金流量表
  - `投资活动现金流出小计` - 现金流量表
  - `分配股利、利润或偿付利息支付的现金` - 现金流量表
- **业务含义**: 反映经营现金流对投资和分红的覆盖能力
- **合理范围**: 通常在0-10之间，理想值大于1.0
- **数据验证**:
  - 投资和分红总额必须大于0
  - 异常值自动修正到合理范围（0-10）
  - 缺失数据时默认值为1.0
- **业务解读**:
  - **>2**: 经营现金流完全能够覆盖投资和分红需求
  - **1-2**: 经营现金流基本能够覆盖投资和分红
  - **<1**: 经营现金流不足以覆盖投资和分红，需要外部融资
  - **负值**: 经营现金流为负，完全依赖外部融资

### 现金能力分析的综合评估

#### 现金流健康度评级
- **优秀 (A)**: 经营现金流为正且增长，自由现金流充裕，各项比率健康
- **良好 (B)**: 经营现金流为正，自由现金流适中，主要指标正常
- **一般 (C)**: 经营现金流波动较大，自由现金流紧张，部分指标需要关注
- **较差 (D)**: 经营现金流为负或持续下降，存在现金流风险

#### 现金流结构分析
1. **经营现金流**: 主营业务的现金创造能力
2. **投资现金流**: 扩张和资产配置的现金需求
3. **筹资现金流**: 融资活动和股东回报的现金流动
4. **现金流匹配**: 三类现金流的协调性和可持续性

## 数据映射规则

### 中文列名优先级

系统支持中英文列名自动映射，**中文列名优先**：

1. **营业收入** → `TOTAL_OPERATE_INCOME`
2. **净利润** → `NETPROFIT`
3. **归属于母公司所有者的净利润** → `PARENT_NETPROFIT`
4. **资产总计** → `TOTAL_ASSETS`
5. **负债合计** → `TOTAL_LIABILITIES`
6. **所有者权益合计** → `TOTAL_EQUITY`
7. **流动资产合计** → `TOTAL_CURRENT_ASSETS`
8. **流动负债合计** → `TOTAL_CURRENT_LIABILITIES`
9. **存货** → `INVENTORY`
10. **营业成本** → `TOTAL_OPERATE_COST`

### 现金流量表数据映射 (新增)
11. **经营活动产生的现金流量净额** → `NETCASH_FLOWS_OPERA`
12. **投资活动现金流出小计** → `CASHFLOWPAID_FOR_INVEST_A`
13. **分配股利、利润或偿付利息支付的现金** → `CASHFLOWPAID_FOR_DIVIDEND`

### 资产负债表补充映射 (新增)
14. **应收账款** → `ACCOUNTS_RECE` / `ACCOUNTS_RECEIVABLE`
15. **固定资产** → `FIXED_ASSETS`
16. **长期投资** → `LONG_INVEST`

### 模糊匹配规则

当精确匹配失败时，系统会尝试模糊匹配：

- **关键词匹配**: 分解列名为关键词，计算匹配度
- **包含匹配**: 检查列名是否包含目标词
- **语义匹配**: 基于50%关键词匹配度认为是同一字段

## 数据验证和容错机制

### 1. 数据质量检查
- **数值范围验证**: 检查数值是否在合理范围内
- **数据类型验证**: 确保数据可转换为数值类型
- **逻辑一致性验证**: 检查相关指标的逻辑关系

### 2. 容错处理策略
- **默认值填充**: 缺失数据使用行业平均值或默认值
- **异常值修正**: 超出合理范围的数据自动修正
- **备选计算**: 提供多种计算路径，提高成功率

### 3. 错误恢复机制
- **详细日志**: 记录所有数据问题和处理过程
- **降级策略**: 关键指标失败时使用简化计算
- **用户提示**: 提供清晰的错误信息和解决建议

## 行业基准参考

### 制造业
- **毛利率**: 15-30%
- **净利率**: 5-15%
- **ROE**: 8-20%
- **资产负债率**: 40-70%

### 金融业
- **净利率**: 20-40%
- **ROE**: 10-25%
- **资产负债率**: 80-95%

### 科技业
- **毛利率**: 40-80%
- **净利率**: 10-30%
- **ROE**: 15-30%
- **资产负债率**: 20-50%

## 性能优化

### 1. 计算缓存
- **结果缓存**: 相同数据结构的计算结果缓存
- **LRU策略**: 限制缓存大小，避免内存泄漏
- **缓存命中率监控**: 实时监控缓存效果

### 2. 批处理优化
- **向量化计算**: 使用NumPy提高计算效率
- **并行处理**: 支持多公司并行分析
- **增量更新**: 支持数据增量计算

## 使用示例

### Python API调用
```python
from utu.tools.financial_analysis_toolkit import StandardFinancialAnalyzer

# 创建分析器
analyzer = StandardFinancialAnalyzer()

# 准备数据
financial_data = {
    "income": [{"营业收入": 1000000000, "净利润": 150000000}],
    "balance": [{"资产总计": 5000000000, "负债合计": 2000000000}]
}

# 计算财务比率
ratios = analyzer.calculate_ratios(json.dumps(financial_data))

# 查看结果
print(f"ROE: {ratios['profitability']['roe']}%")
print(f"资产负债率: {ratios['solvency']['debt_to_asset_ratio']}%")
```

### 智能体工具调用
```python
# 在智能体中使用
toolkit = TabularDataToolkit(config)
result = await toolkit.generate_charts(data_json, "comparison", "./output")
```

## 故障排除

### 常见问题
1. **列名不匹配**: 检查数据中的列名是否包含支持的中文列名
2. **数值异常**: 查看日志中的数据验证警告
3. **计算失败**: 确认数据结构完整性，至少包含利润表和资产负债表

### 调试建议
1. **启用详细日志**: 设置日志级别为DEBUG
2. **检查数据映射**: 使用_get_value方法单独测试列名提取
3. **验证数据格式**: 确保JSON格式正确，数值类型有效

---

**文档版本**: v1.0
**最后更新**: 2025-10-25
**维护者**: 财务分析系统开发团队